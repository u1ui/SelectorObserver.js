<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Tests</title>
    <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css" />

<body>
    <div id="mocha"></div>

    <script src="https://unpkg.com/chai/chai.js"></script>
    <script src="https://unpkg.com/mocha/mocha.js"></script>

    <script class="mocha-init">
        mocha.setup('bdd');
        mocha.checkLeaks();
    </script>

    <div class=container>
        <div class=item id=el1>added before</div>
    </div>

    <script type=module>
    import {SelectorObserver} from '../SelectorObserver.js';

    describe('SelectorObserver', () => {
        let lastAdded = null;
        let lastRemoved = null;
        let o = new SelectorObserver({
            on: el => lastAdded = el ,
            off : el => lastRemoved = el ,
        });
        o.observe('.container > .item');

        let el2 = document.createElement('div');
        el2.classList.add('item');
        el2.id = 'el2';

        it('found existing:', () => {
            chai.expect(lastAdded).to.equal(el1);
        });

        it('add dynamicly:', done => {
            lastAdded = lastRemoved = null;
            console.log(lastAdded)
            console.log(lastAdded)
            // el1.after(el2)
            // setTimeout(()=>{
            //     chai.expect(lastAdded).to.equal(el2);
            //     done();
            // })
        });

        it('remove class:', done => {
            lastAdded = lastRemoved = null;
            el2.classList.remove('item');
            setTimeout(()=>{
                chai.expect(lastRemoved).to.equal(el2);
                done();
            })
        });

        it('remove element:', done => {
            lastAdded = lastRemoved = null;
            el2.remove();
            setTimeout(()=>{
                chai.expect(lastRemoved).to.equal(el2);
                done();
            })
        });

        /*
        it('add wrapped:', done => {
            lastAdded = lastRemoved = null;
            console.log(lastAdded)
            el1.insertAdjacentHTML('afterend', '<div id=wrapper><div class=item id=el2>dynamic</div></div>');
            setTimeout(()=>{
                console.log(lastAdded)
                chai.expect(lastAdded).to.equal(el2);
                done();
            })
        });

        it('remove wrapped:', done => {
            lastAdded = lastRemoved = null;
            wrapper.remove();
            setTimeout(()=>{
                chai.expect(lastRemoved).to.equal(el2);
            })
        });
        */

        it('add after disconnect:', done => {
            o.disconnect();
            el1.insertAdjacentHTML('afterend', '<div class=item>after disconnect</div>');
            setTimeout(()=>{
                chai.expect(lastAdded).to.equal(el2);
                done();
            });
        });

    });

    </script>
    <script class="mocha-exec" type=module>
      mocha.run();
    </script>
</body>

</html>