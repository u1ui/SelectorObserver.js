<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Tests</title>
    <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css" />

<body>
    <div id="mocha"></div>

    <script src="https://unpkg.com/chai/chai.js"></script>
    <script src="https://unpkg.com/mocha/mocha.js"></script>

    <script class="mocha-init">
        mocha.setup('bdd');
        mocha.checkLeaks();
    </script>

    <div class=container>
        <div class=item id=el1>added before</div>
    </div>

    <script type=module>
    import {SelectorObserver} from '../SelectorObserver.js';

    describe('SelectorObserver', () => {
        let lastAdded = null;
        let lastRemoved = null;
        let o = new SelectorObserver({
            on: el => lastAdded = el ,
            off : el => lastRemoved = el ,
        });
        o.observe('.container .item');

        it('found existing:', () => {
            chai.expect(lastAdded).to.equal(el1);
        });

        it('add dynamicly:', () => {
            const el = document.createElement('div');
            el.classList.add('item');
            el.id = 'el2';
            el1.after(el);
            setTimeout(()=>{
                chai.expect(el).to.equal(lastAdded);
            })
        });

        it('remove class:', () => {
            el1.classList.remove('item');
            setTimeout(()=>{
                chai.expect(lastRemoved).to.equal(el1);
            })
        });

        it('remove element 2:', () => {
            el2.remove();
            setTimeout(()=>{
                chai.expect(lastRemoved).to.equal(el2);
            })
        });

        it('add wrapped:', () => {
            el1.insertAdjacentHTML('afterend', '<div id=wrapped><div class="wrapped item">wrapped</div></div>');
        });

        it('remove wrapped:', () => {
            wrapped.remove();
        });

        it('add after disconnect:', () => {
            el1.insertAdjacentHTML('afterend', '<div class=item>after disconnect</div>');
        });

        it('disconnect:', () => {
            o.disconnect();
        });

        it('add after disconnect:', () => {
            el1.insertAdjacentHTML('afterend', '<div class=item>after disconnect</div>');
        });
    });

    </script>
    <script class="mocha-exec" type=module>
      mocha.run();
    </script>
</body>

</html>